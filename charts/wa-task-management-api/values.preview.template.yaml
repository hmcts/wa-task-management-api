java:
  image: ${IMAGE_NAME}
  ingressHost: ${SERVICE_FQDN}
  keyVaults:
    wa:
      secrets:
        - name: AppInsightsInstrumentationKey
          alias: azure.application-insights.instrumentation-key
        - name: wa-system-username
          alias: WA_SYSTEM_USERNAME
        - name: wa-system-password
          alias: WA_SYSTEM_PASSWORD
        - name: wa-idam-client-secret
          alias: WA_IDAM_CLIENT_SECRET
        - name: s2s-secret-task-management-api
          alias: S2S_SECRET_TASK_MANAGEMENT_API
        - name: ld-secret
          alias: LAUNCH_DARKLY_SDK_KEY
  environment:
    CAMUNDA_URL: "http://camunda-api-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal/engine-rest"
    IDAM_URL: "https://idam-api.{{ .Values.global.environment }}.platform.hmcts.net"
    S2S_URL: "http://rpe-service-auth-provider-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal"
    OPEN_ID_IDAM_URL: "https://idam-web-public.{{ .Values.global.environment }}.platform.hmcts.net"
    ROLE_ASSIGNMENT_URL: "http://am-role-assignment-service-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal"
    POSTGRES_HOST: "{{ .Release.Name }}-postgresql"
    POSTGRES_REPLICA_HOST: "{{ .Release.Name }}-postgresql"
    POSTGRES_REPLICA_PORT: 5432
    POSTGRES_NAME: "{{ .Values.postgresql.auth.database}}"
    POSTGRES_REPLICA_NAME: "cft_task_db_replica"
    POSTGRES_USERNAME: "{{ .Values.postgresql.auth.username}}"
    POSTGRES_PASSWORD: "{{ .Values.postgresql.auth.password}}"
    REPLICATION_USERNAME: "{{ .Values.postgresql.auth.username}}"
    REPLICATION_PASSWORD: "{{ .Values.postgresql.auth.password}}"
    POSTGRES_CONNECTION_OPTIONS: ""
    SPRING_PROFILES_ACTIVE: "preview,replica"
    DB_READER_USERNAME: "{{ .Values.postgresql.auth.username}}"
    MANDATORY_TASK_FIELD_CHECK_ENABLED: true
  postgresql:
    enabled: true
    auth:
      database: cft_task_db
    primary:
      persistence:
        enabled: false
      extraEnvVars:
        - name: POSTGRESQL_WAL_LEVEL
          value: "logical"
      resources:
        requests:
          cpu: 25m
      initdb:
        user: postgres
        scripts:
          init.sql: |
            ALTER ROLE javapostgres WITH SUPERUSER;
            CREATE DATABASE "cft_task_db_replica" WITH OWNER = javapostgres ENCODING = 'UTF-8' CONNECTION LIMIT = -1;

wa:
  enabled: true
  wa:
    global:
      postgresUsername: hmcts
      postgresSecret: postgres
      postgresHost: ${SERVICE_NAME}-postgresql
    #    postgresHost: civil-preview.postgres.database.azure.com
    #    databaseNamePrefix: "pr-${CHANGE_ID}-"
    wa:
      postgresql:
        enabled: false
    wa-case-event-handler:
      java:
        ingressHost: wa-case-event-handler-${SERVICE_FQDN}
        releaseNameOverride: ${SERVICE_NAME}-wa-case-event-handler
        secrets:
          AZURE_SERVICE_BUS_CONNECTION_STRING:
            secretRef: civil-sb-preview
            key: connectionString
          POSTGRES_PASSWORD:
            secretRef: "{{ .Values.global.postgresSecret }}"
            key: PASSWORD
            disabled: true
        environment:
          CCD_URL: http://{{ .Release.Name }}-ccd-data-store-api
          CCD_SEARCH_URL: http://{{ .Release.Name }}-ccd-data-store-api
          ROLE_ASSIGNMENT_URL: http://am-role-assignment-service-aat.service.core-compute-aat.internal
          AZURE_SERVICE_BUS_TOPIC_NAME: ${SERVICE_NAME}-asb-events
          AZURE_SERVICE_BUS_SUBSCRIPTION_NAME: ${SERVICE_NAME}-asb-events
          #AZURE_SERVICE_BUS_TOPIC_NAME: servicebus-topic-{{ .Release.Name }}-asb-ccd-case-events
          AZURE_SERVICE_BUS_CCD_CASE_EVENTS_SUBSCRIPTION_NAME: ${SERVICE_NAME}-asb-events
          POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
          POSTGRES_CONNECTION_OPTIONS: "?stringtype=unspecified"

    wa-task-monitor:
      java:
        ingressHost: wa-task-monitor-${SERVICE_FQDN}
        environment:
          WA_TASK_MANAGEMENT_API_URL: http://{{ .Release.Name }}-wa-task-management-api
          ROLE_ASSIGNMENT_URL: http://am-role-assignment-service-aat.service.core-compute-aat.internal

    wa-task-management-api:
      enabled: false
      java:
        ingressHost: wa-task-mng-${SERVICE_FQDN}
        environment:
          ROLE_ASSIGNMENT_URL: http://am-role-assignment-service-aat.service.core-compute-aat.internal
          POSTGRES_CONNECTION_OPTIONS: "?stringtype=unspecified"
          POSTGRES_HOST: "{{ .Release.Name }}-postgresql"
          POSTGRES_REPLICA_HOST: "{{ .Release.Name }}-postgresql"
          POSTGRES_REPLICA_PORT: 5432
          POSTGRES_NAME: "cft_task_db"
          POSTGRES_REPLICA_NAME: "cft_task_db_replica"
          POSTGRES_USERNAME: postgres
          POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
          REPLICATION_USERNAME: postgres
          REPLICATION_PASSWORD: ${POSTGRES_PASSWORD}
          SPRING_PROFILES_ACTIVE: "preview"
          DB_READER_USERNAME: postgres
        secrets:
          POSTGRES_PASSWORD:
            secretRef: "{{ .Values.global.postgresSecret }}"
            key: PASSWORD
            disabled: true
    wa-workflow-api:
      java:
        environment:
          DB_READER_USERNAME: "hmcts"
          POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
          POSTGRES_CONNECTION_OPTIONS: "?stringtype=unspecified"
          CAMUNDA_URL: https://camunda-${SERVICE_FQDN}/engine-rest/
      secrets:
        POSTGRES_PASSWORD:
          secretRef: "{{ .Values.global.postgresSecret }}"
          key: PASSWORD
          disabled: true
    wa-initiation-batch:
      job:
        schedule: "*/1 * * * *"
        releaseNameOverride: "{{ .Release.Name }}-wa-task-batch"
    wa-reconfiguration-batch:
      job:
        schedule: "*/1 * * * *"
        releaseNameOverride: "{{ .Release.Name }}-reconfiguration"
    wa-termination-batch:
      job:
        schedule: "*/1 * * * *"
        releaseNameOverride: "{{ .Release.Name }}-termination-batch"
    wa-message-cron-service:
      job:
        schedule: "*/1 * * * *"
        releaseNameOverride: "{{ .Release.Name }}-wa-message-cron"

    camunda-bpm:
      java:
        environment:
          CAMUNDA_DB_USER_NAME: "hmcts"
          CAMUNDA_DB_PASSWORD: ${POSTGRES_PASSWORD}
          CAMUNDA_DB_CONN_OPTIONS: "?stringtype=unspecified"
          CAMUNDA_DB_NAME: 'camunda'
          TASK_MANAGEMENT_API_URL: http://{{ .Release.Name }}-wa-task-management-api
          CAMUNDA_API_AUTH_ENABLED: false
          CAMUNDA_DB_HOST: ${SERVICE_NAME}-postgresql
          CAMUNDA_BPM_DATABASE_SCHEMA_UPDATE: true
          ingressHost: camunda-${SERVICE_FQDN}
          disableKeyVaults: true
          releaseNameOverride: ${SERVICE_NAME}-camunda
          S2S_URL: http://rpe-service-auth-provider-aat.service.core-compute-aat.internal
        secrets:
          CAMUNDA_DB_PASSWORD:
            secretRef: "{{ .Values.global.postgresSecret }}"
            key: PASSWORD
            disabled: true

#camunda-bpm:
#  enabled: true
#  java:
#    releaseNameOverride: "{{ .Release.Name }}-camunda"
#    ingressHost: "camunda-{{ .Release.Name }}.preview.platform.hmcts.net"
#    disableKeyVaults: true
#    environment:
#      CAMUNDA_DB_HOST: "{{ .Release.Name }}-postgresql"
#      CAMUNDA_DB_USER_NAME: hmcts
#      CAMUNDA_DB_PASSWORD: ${GENERIC_HMCTS_YAML_PASS}
#      CAMUNDA_DB_CONN_OPTIONS: ""
#      CAMUNDA_DB_NAME: camunda
#      TASK_MANAGEMENT_API_URL: http://{{ .Release.Name }}-wa-task-management-api
#      CAMUNDA_BPM_DATABASE_SCHEMAUPDATE: true
#      RELEASE_REVISION: "{{ .Release.Revision }}"
#      CAMUNDA_API_AUTH_ENABLED: false
