java:
  image: ${IMAGE_NAME}
  ingressHost: ${SERVICE_FQDN}
  keyVaults:
    wa:
      secrets:
        - name: AppInsightsInstrumentationKey
          alias: azure.application-insights.instrumentation-key
        - name: wa-system-username
          alias: WA_SYSTEM_USERNAME
        - name: wa-system-password
          alias: WA_SYSTEM_PASSWORD
        - name: wa-idam-client-secret
          alias: WA_IDAM_CLIENT_SECRET
        - name: s2s-secret-task-management-api
          alias: S2S_SECRET_TASK_MANAGEMENT_API
        - name: ld-secret
          alias: LAUNCH_DARKLY_SDK_KEY
  environment:
    CAMUNDA_URL: "http://camunda-api-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal/engine-rest"
    IDAM_URL: "https://idam-api.{{ .Values.global.environment }}.platform.hmcts.net"
    S2S_URL: "http://rpe-service-auth-provider-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal"
    OPEN_ID_IDAM_URL: "https://idam-web-public.{{ .Values.global.environment }}.platform.hmcts.net"
    ROLE_ASSIGNMENT_URL: "http://am-role-assignment-service-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal"
    POSTGRES_HOST: "{{ .Release.Name }}-postgresql"
    POSTGRES_REPLICA_HOST: "{{ .Release.Name }}-postgresql"
    POSTGRES_REPLICA_PORT: 5432
    POSTGRES_NAME: "{{ .Values.postgresql.auth.database}}"
    POSTGRES_REPLICA_NAME: "cft_task_db_replica"
    POSTGRES_USERNAME: "{{ .Values.postgresql.auth.username}}"
    POSTGRES_PASSWORD: "{{ .Values.postgresql.auth.password}}"
    REPLICATION_USERNAME: "{{ .Values.postgresql.auth.username}}"
    REPLICATION_PASSWORD: "{{ .Values.postgresql.auth.password}}"
    POSTGRES_CONNECTION_OPTIONS: ""
    SPRING_PROFILES_ACTIVE: "preview,replica"
    DB_READER_USERNAME: "{{ .Values.postgresql.auth.username}}"
    MANDATORY_TASK_FIELD_CHECK_ENABLED: true
  postgresql:
    enabled: true
    auth:
      database: cft_task_db
    primary:
      persistence:
        enabled: false
      extraEnvVars:
        - name: POSTGRESQL_WAL_LEVEL
          value: "logical"
      resources:
        requests:
          cpu: 25m
      initdb:
        user: postgres
        scripts:
          init.sql: |
            ALTER ROLE javapostgres WITH SUPERUSER;
            CREATE DATABASE "cft_task_db_replica" WITH OWNER = javapostgres ENCODING = 'UTF-8' CONNECTION LIMIT = -1;

wa:
  enabled: true
  wa:
    taskManagement:
      enabled: false
    taskMonitor:
      enabled: true
    eventHandler:
      enabled: false
    wa-workflow-api:
      enabled: false
    taskBatchCron:
      enabled: false
    messageCron:
      enabled: false
    servicebus:
      enabled: false
    postgresql:
      enabled: false
    camunda:
      enabled: false
    reconfigurationBatchCron:
      enabled: false
    terminationBatchCron:
      enabled: false

#camunda-bpm:
#  enabled: true
#  java:
#    releaseNameOverride: "{{ .Release.Name }}-camunda"
#    ingressHost: "camunda-{{ .Release.Name }}.preview.platform.hmcts.net"
#    disableKeyVaults: true
#    environment:
#      CAMUNDA_DB_HOST: "{{ .Release.Name }}-postgresql"
#      CAMUNDA_DB_USER_NAME: hmcts
#      CAMUNDA_DB_PASSWORD: ${GENERIC_HMCTS_YAML_PASS}
#      CAMUNDA_DB_CONN_OPTIONS: ""
#      CAMUNDA_DB_NAME: camunda
#      TASK_MANAGEMENT_API_URL: http://{{ .Release.Name }}-wa-task-management-api
#      CAMUNDA_BPM_DATABASE_SCHEMAUPDATE: true
#      RELEASE_REVISION: "{{ .Release.Revision }}"
#      CAMUNDA_API_AUTH_ENABLED: false

wa-case-event-handler:
  java:
    ingressHost: ""
    releaseNameOverride: "{{ .Release.Name }}-ceh"
    secrets:
      AZURE_SERVICE_BUS_CONNECTION_STRING:
        secretRef: servicebus-access
        key: connectionString
      POSTGRES_PASSWORD:
        secretRef: "{{ .Values.global.postgresSecret }}"
        key: PASSWORD
        disabled: false
    keyVaults:
      wa:
        secrets:
          - name: s2s-secret-case-event-handler
            alias: S2S_SECRET_CASE_EVENT_HANDLER
          - name: ld-secret
            alias: LAUNCH_DARKLY_SDK_KEY
          - name: wa-idam-client-secret
            alias: WA_IDAM_CLIENT_SECRET
    environment:
      CAMUNDA_URL: http://{{ .Release.Name }}-camunda/engine-rest
      CCD_URL: http://{{ .Release.Name }}-ccd-data-store-api
      CCD_SEARCH_URL: http://{{ .Release.Name }}-ccd-data-store-api
      ROLE_ASSIGNMENT_URL: http://{{ .Release.Name }}-am-role-assignment-service
      WA_WORKFLOW_API_URL: http://{{ .Release.Name }}-wa-workflow-api
      WA_TASK_MANAGEMENT_API_URL: http://{{ .Release.Name }}-wa-task-management-api
      AZURE_SERVICE_BUS_TOPIC_NAME: "{{ .Release.Name }}-servicebus-ccd-case-events"
      AZURE_SERVICE_BUS_SUBSCRIPTION_NAME: "{{ .Release.Name }}-servicebus-ccd-case-events"
      AZURE_SERVICE_BUS_CCD_CASE_EVENTS_SUBSCRIPTION_NAME: "{{ .Release.Name }}-servicebus-ccd-case-events"
      POSTGRES_NAME: '{{ tpl .Values.global.databaseNamePrefix $}}wa-case-event-handler'
      POSTGRES_HOST: '{{ tpl .Values.global.postgresHost $}}'
      POSTGRES_USERNAME: '{{ tpl .Values.global.postgresUsername $}}'
      POSTGRES_CONNECTION_OPTIONS: "?stringtype=unspecified&reWriteBatchedInserts=true&sslmode=require"
      RECEIVED_MESSAGE_HEALTH_CHECK: disabled
